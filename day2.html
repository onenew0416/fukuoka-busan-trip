<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 2: å¤ªå®°åºœåƒæ‹œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .modal-enter { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        /* ç¶ è‰²ä¸»é¡Œ */
        .text-custom-green { color: rgb(0, 140, 0); }
        .bg-custom-green { background-color: rgb(0, 140, 0); }
        .border-custom-green { border-color: rgb(0, 140, 0); }
        .ring-custom-green { --tw-ring-color: rgb(0, 140, 0); }
        .bg-gradient-custom { background: linear-gradient(135deg, rgb(0, 140, 0) 0%, rgb(0, 100, 0) 100%); }
    </style>
</head>
<body class="bg-green-50 text-slate-800 pb-24">

    <div class="p-6 pt-10 flex justify-between items-center">
		<div class="flex-1">
            <h1 class="text-xl sm:text-2xl font-bold text-slate-800 whitespace-nowrap overflow-hidden text-ellipsis mr-2">
                ç¦å²¡ Fukuoka ğŸ‡¯ğŸ‡µ x é‡œå±± Busan ğŸ‡°ğŸ‡·
            </h1>
		</div>
		<div class="invisible bg-white border border-green-100 shadow-sm rounded-xl px-3 py-1.5 flex flex-col items-center justify-center active:scale-95 transition flex-shrink-0">
            <i class="fas fa-cloud-sun text-custom-green text-lg mb-0.5"></i>
            <span class="text-[10px] font-bold text-slate-500">æ—…é€”æ°£è±¡</span>
        </div>			
    </div>

    <div class="flex overflow-x-auto px-4 space-x-3 hide-scroll mb-6 pb-2" id="date-nav">
        <a href="index.html" class="flex-shrink-0 w-16 h-24 bg-white rounded-2xl flex flex-col justify-center items-center shadow-sm text-slate-400 transition-transform active:scale-95">
            <i class="fas fa-clipboard-list mb-1 text-lg"></i><span class="text-xs font-bold">ç›®éŒ„</span>
        </a>
        
        <a href="day1.html" class="flex-shrink-0 w-16 h-24 bg-white rounded-2xl flex flex-col justify-center items-center shadow-sm text-slate-500 text-xs leading-tight block transition active:scale-95">
            <span class="text-[10px] text-slate-400">Day 1</span><span class="text-lg font-bold text-slate-700 my-0.5">02/24</span><span>(äºŒ)</span>
        </a>

        <div id="active-tab" class="flex-shrink-0 w-16 h-24 bg-custom-green rounded-2xl flex flex-col justify-center items-center shadow-lg shadow-green-200 text-white relative">
            <span class="text-[10px] text-green-100">Day 2</span><span class="text-lg font-bold my-0.5">02/25</span><span>(ä¸‰)</span>
            <div class="absolute -bottom-1 w-1 h-1 bg-white rounded-full"></div>
        </div>

        <a href="day3.html" class="flex-shrink-0 w-16 h-24 bg-white rounded-2xl flex flex-col justify-center items-center shadow-sm text-slate-500 text-xs leading-tight block transition active:scale-95"><span class="text-[10px] text-slate-400">Day 3</span><span class="text-lg font-bold text-slate-700 my-0.5">02/26</span><span>(å››)</span></a>
        <a href="day4.html" class="flex-shrink-0 w-16 h-24 bg-white rounded-2xl flex flex-col justify-center items-center shadow-sm text-slate-500 text-xs leading-tight block transition active:scale-95"><span class="text-[10px] text-slate-400">Day 4</span><span class="text-lg font-bold text-slate-700 my-0.5">02/27</span><span>(äº”)</span></a>
        <a href="day5.html" class="flex-shrink-0 w-16 h-24 bg-white rounded-2xl flex flex-col justify-center items-center shadow-sm text-slate-500 text-xs leading-tight block transition active:scale-95"><span class="text-[10px] text-slate-400">Day 5</span><span class="text-lg font-bold text-slate-700 my-0.5">02/28</span><span>(å…­)</span></a>
        <a href="day6.html" class="flex-shrink-0 w-16 h-24 bg-white rounded-2xl flex flex-col justify-center items-center shadow-sm text-slate-500 text-xs leading-tight block transition active:scale-95"><span class="text-[10px] text-slate-400">Day 6</span><span class="text-lg font-bold text-slate-700 my-0.5">03/01</span><span>(æ—¥)</span></a>
        <a href="day7.html" class="flex-shrink-0 w-16 h-24 bg-white rounded-2xl flex flex-col justify-center items-center shadow-sm text-slate-500 text-xs leading-tight block transition active:scale-95"><span class="text-[10px] text-slate-400">Day 7</span><span class="text-lg font-bold text-slate-700 my-0.5">03/02</span><span>(ä¸€)</span></a>
        <a href="day8.html" class="flex-shrink-0 w-16 h-24 bg-white rounded-2xl flex flex-col justify-center items-center shadow-sm text-slate-500 text-xs leading-tight block transition active:scale-95"><span class="text-[10px] text-slate-400">Day 8</span><span class="text-lg font-bold text-slate-700 my-0.5">03/03</span><span>(äºŒ)</span></a>
        <a href="day9.html" class="flex-shrink-0 w-16 h-24 bg-white rounded-2xl flex flex-col justify-center items-center shadow-sm text-slate-500 text-xs leading-tight block transition active:scale-95"><span class="text-[10px] text-slate-400">Day 9</span><span class="text-lg font-bold text-slate-700 my-0.5">03/04</span><span>(ä¸‰)</span></a>
    </div>

    <div class="mx-4 mb-6 p-5 bg-green-100 rounded-3xl shadow-sm flex items-center justify-between relative overflow-hidden" id="weather-widget">
        <div class="z-10">
            <div class="flex items-baseline" id="weather-temp-container">
                <span class="text-3xl font-bold text-slate-800">--Â°</span>
                <span class="text-xl text-slate-400 mx-1">/</span>
                <span class="text-2xl font-bold text-slate-600">--Â°</span>
            </div>
            <div id="weather-desc" class="text-xs text-slate-500 mt-1 font-bold">
                <i class="fas fa-spinner fa-spin"></i> è¼‰å…¥æ°£è±¡ä¸­...
            </div>
        </div>
        <div class="z-10 text-right">
            <span class="bg-white/50 px-2 py-1 rounded-lg text-xs font-bold text-slate-600">
                <i class="fas fa-map-marker-alt text-custom-green"></i> ç¦å²¡ Fukuoka
            </span>
            <i id="weather-icon" class="fas fa-cloud text-5xl text-slate-400 block mt-3 transition-all duration-500 drop-shadow-sm"></i>
        </div>
        <div class="absolute -right-6 -top-6 w-24 h-24 bg-green-200/50 rounded-full blur-xl"></div>
    </div>

    <div class="mx-4 flex justify-between items-center mb-4">
        <h2 class="text-lg font-bold bg-green-200/50 px-3 py-1 rounded-lg text-slate-700">è¡Œç¨‹å®‰æ’</h2>
        <button onclick="openModal()" class="bg-slate-700 text-white px-4 py-1.5 rounded-full text-sm shadow-md active:scale-95 transition-transform hover:bg-slate-800">+ æ–°å¢</button>
    </div>

    <div id="schedule-container" class="space-y-4 pb-4"></div>

    <div id="add-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white w-[90%] max-w-sm rounded-3xl p-6 shadow-2xl modal-enter overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-center mb-4"><h3 id="modal-title" class="text-xl font-bold text-slate-800">æ–°å¢è¡Œç¨‹</h3><button onclick="closeModal()" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times text-xl"></i></button></div>
            <form id="add-form" onsubmit="handleFormSubmit(event)">
                <input type="hidden" id="input-id">
                <div class="space-y-4">
                    <div><label class="block text-xs font-bold text-slate-500 mb-1">é¡å‹</label>
                        <select id="input-type" onchange="toggleFlightInputs()" class="w-full bg-slate-100 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none focus:ring-2 focus:ring-custom-green appearance-none">
                            <option value="spot">ğŸ“ æ™¯é»</option><option value="food">ğŸœ é¤é£²</option><option value="train">ğŸš† äº¤é€š</option><option value="bus">ğŸšŒ å·´å£«</option><option value="ferry">ğŸš¢ èˆ¹ç­</option><option value="flight">âœˆï¸ èˆªç­</option><option value="shop">ğŸ›ï¸ è³¼ç‰©</option><option value="car">ğŸš— ç§Ÿè»Š</option><option value="hotel">ğŸ¨ ä½å®¿</option>
                        </select>
                    </div>
                    <div class="flex gap-3"><div class="flex-1"><label id="label-time-start" class="block text-xs font-bold text-slate-500 mb-1">æ™‚é–“</label><input type="time" id="input-time" required class="w-full bg-slate-100 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none focus:ring-2 focus:ring-custom-green"></div><div id="arrival-time-block" class="flex-1 hidden"><label class="block text-xs font-bold text-slate-500 mb-1">æŠµé”æ™‚é–“</label><input type="time" id="input-time-end" class="w-full bg-slate-100 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none focus:ring-2 focus:ring-custom-green"></div></div>
                    <div><label id="label-title" class="block text-xs font-bold text-slate-500 mb-1">æ¨™é¡Œ</label><input type="text" id="input-title" required class="w-full bg-slate-100 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none focus:ring-2 focus:ring-custom-green"></div>
                    <div><label id="label-sub" class="block text-xs font-bold text-slate-500 mb-1">åœ°é» / å‚™è¨»</label><input type="text" id="input-sub" class="w-full bg-slate-100 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none focus:ring-2 focus:ring-custom-green"><p id="flight-hint" class="text-[10px] text-slate-400 mt-1 hidden">æ ¼å¼ï¼šTPE æ¡ƒåœ’ - FUK ç¦å²¡</p></div>
                    <div class="pt-2 border-t border-slate-100"><div class="flex gap-3"><div class="flex-1"><label class="block text-xs font-bold text-slate-500 mb-1">é€£çµåç¨±</label><input type="text" id="input-link-text" placeholder="åœ°åœ–" class="w-full bg-slate-100 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none focus:ring-2 focus:ring-custom-green text-sm"></div><div class="flex-[2]"><label class="block text-xs font-bold text-slate-500 mb-1">é€£çµç¶²å€</label><input type="url" id="input-link" class="w-full bg-slate-100 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none focus:ring-2 focus:ring-custom-green text-sm"></div></div></div>
                </div>
                <button type="submit" id="submit-btn" class="w-full bg-custom-green text-white font-bold py-3 rounded-xl mt-6 shadow-lg shadow-green-300 hover:bg-[#008c00] transition">ç¢ºèªæ–°å¢</button>
            </form>
        </div>
    </div>

    <div class="fixed bottom-6 left-4 right-4 bg-white rounded-full shadow-2xl py-3 px-6 flex justify-between items-center z-40">
        <div class="flex flex-col items-center text-custom-green cursor-pointer w-1/3">
            <i class="fas fa-suitcase text-lg mb-1"></i><span class="text-[10px] font-bold">è¡Œç¨‹</span>
        </div>
        <a href="accounting.html" class="flex flex-col items-center text-slate-400 hover:text-custom-green cursor-pointer w-1/3">
            <i class="fas fa-wallet text-lg mb-1"></i><span class="text-[10px]">è¨˜å¸³</span>
        </a>
        <a href="shopping.html" class="flex flex-col items-center text-slate-400 hover:text-custom-green cursor-pointer w-1/3">
            <i class="fas fa-shopping-bag text-lg mb-1"></i><span class="text-[10px]">è³¼ç‰©</span>
        </a>
    </div>

    <script type="module">
        // 1. å¼•å…¥ Firebase å‡½å¼åº« (å¾ Google CDN)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    
        // 2. è²¼ä¸Šä½ çš„ Firebase è¨­å®š (è«‹æ›¿æ›é€™è£¡ï¼)
        const firebaseConfig = {
        apiKey: "AIzaSyA866R1dunG70pNX91BhvIVortnlB5QuHU",
        authDomain: "fukuoka-busan-trip.firebaseapp.com",
        projectId: "fukuoka-busan-trip",
        storageBucket: "fukuoka-busan-trip.firebasestorage.app",
        messagingSenderId: "130540342304",
        appId: "1:130540342304:web:f4a3f225ab3f2b37f00045",
        measurementId: "G-XDV9S0066R"
        };

    
        // 3. åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const CURRENT_DAY = 'day2'; // è¨­å®šé€™æ˜¯å“ªä¸€å¤©çš„é é¢
        
        // ç”¨ä¾†å­˜æ”¾ä¸‹è¼‰ä¸‹ä¾†çš„è³‡æ–™
        let scheduleData = [];
    
        // ==========================================
        // æ™ºæ…§å¤©æ°£åŠŸèƒ½ (å–®åŸå¸‚ - ç¦å²¡)
        // ==========================================
        
        // âš ï¸ è«‹ä¾ç…§ä¸åŒåˆ†é ä¿®æ”¹é€™è£¡çš„æ—¥æœŸï¼
        const TARGET_DATE = '2026-02-25'; // Day 1=24, Day 2=25, Day 3=26, Day 4=27

        // ç¦å²¡åº§æ¨™
        const CITY_GEO = { lat: 33.59, lon: 130.40 };

        // æ­·å²å‚™ä»½è³‡æ–™ (ä¾æ—¥æœŸå°ç…§)
        const HISTORY_DATA = {
            '2026-02-24': { high: 11, low: 4, rain: 10, code: 0 },  // Day 1
            '2026-02-25': { high: 12, low: 5, rain: 20, code: 2 },  // Day 2
            '2026-02-26': { high: 10, low: 6, rain: 60, code: 63 }, // Day 3
            '2026-02-27': { high: 9, low: 3, rain: 30, code: 3 }    // Day 4
        };

        async function fetchWeather() {
            const tripDate = new Date(TARGET_DATE);
            const today = new Date();
            const diffDays = (tripDate - today) / (1000 * 60 * 60 * 24);

            // å¦‚æœè·é›¢æ—¥æœŸå°æ–¼ 14 å¤©ï¼Œå˜—è©¦æŠ“å– API
            if (diffDays <= 14 && diffDays >= -1) {
                console.log(`Day Page: Fetching live weather for ${TARGET_DATE}`);
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${CITY_GEO.lat}&longitude=${CITY_GEO.lon}&start_date=${TARGET_DATE}&end_date=${TARGET_DATE}&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=auto`;
                try {
                    const res = await fetch(url);
                    const data = await res.json();
                    if(data.daily) {
                        updateWeatherUI({
                            high: Math.round(data.daily.temperature_2m_max[0]),
                            low: Math.round(data.daily.temperature_2m_min[0]),
                            rain: data.daily.precipitation_probability_max ? data.daily.precipitation_probability_max[0] : 0,
                            code: data.daily.weathercode[0]
                        });
                        return;
                    }
                } catch(e) { console.error("API Error, using history", e); }
            }

            // å¦å‰‡ (æˆ–å¤±æ•—æ™‚) ä½¿ç”¨æ­·å²è³‡æ–™
            console.log(`Day Page: Using history data for ${TARGET_DATE}`);
            const history = HISTORY_DATA[TARGET_DATE] || { high: '--', low: '--', rain: 0, code: 0 };
            updateWeatherUI(history);
        }

        function updateWeatherUI(data) {
            const tempContainer = document.getElementById('weather-temp-container');
            const descEl = document.getElementById('weather-desc');
            const iconEl = document.getElementById('weather-icon');

            // é¡¯ç¤ºæº«åº¦
            tempContainer.innerHTML = `
                <span class="text-3xl font-bold text-slate-800">${data.high}Â°</span>
                <span class="text-xl text-slate-400 mx-1">/</span>
                <span class="text-2xl font-bold text-slate-600">${data.low}Â°</span>
            `;

            // è§£æå¤©æ°£ä»£ç¢¼
            const w = getWeatherIcon(data.code);

            // é¡¯ç¤ºæè¿° + è—è‰²é™é›¨æ©Ÿç‡
            descEl.innerHTML = `${w.text} <span class="ml-2 text-blue-500 font-bold">${data.rain}%</span>`;
            
            // é¡¯ç¤º Icon
            iconEl.className = `fas ${w.icon} text-5xl block mt-3 transition-all duration-500 ${w.color} drop-shadow-sm`;
        }

        // å¤©æ°£ä»£ç¢¼è½‰æ›è¡¨
        function getWeatherIcon(code) {
            if (code === 0) return { icon: 'fa-sun', color: 'text-orange-400', text: 'æ™´æœ—' };
            if (code >= 1 && code <= 3) return { icon: 'fa-cloud-sun', color: 'text-yellow-400', text: 'å¤šé›²æ™‚æ™´' };
            if (code === 45 || code === 48) return { icon: 'fa-smog', color: 'text-slate-400', text: 'æœ‰éœ§' };
            if ((code >= 51 && code <= 67) || (code >= 80 && code <= 82)) return { icon: 'fa-cloud-rain', color: 'text-blue-400', text: 'æœ‰é›¨' };
            if ((code >= 71 && code <= 77) || (code >= 85 && code <= 86)) return { icon: 'fa-snowflake', color: 'text-blue-200', text: 'ä¸‹é›ª' };
            if (code >= 95) return { icon: 'fa-bolt', color: 'text-purple-500', text: 'é›·é›¨' };
            return { icon: 'fa-cloud', color: 'text-slate-400', text: 'å¤šé›²' };
        }
	
        // ==========================================
        // 4. è®€å–è³‡æ–™ (Read)
        // ==========================================
        async function loadSchedules() {
            try {
                // å»ºç«‹æŸ¥è©¢ï¼šåªæŠ“ day == 'day1' çš„è³‡æ–™
                const q = query(collection(db, "schedules"), where("day", "==", CURRENT_DAY));
                const querySnapshot = await getDocs(q);
                
                scheduleData = [];
                querySnapshot.forEach((doc) => {
                    // æŠŠ Firebase çš„è³‡æ–™è½‰æˆæˆ‘å€‘éœ€è¦çš„æ ¼å¼ (åŒ…å« ID)
                    scheduleData.push({ id: doc.id, ...doc.data() });
                });
    
                // ä¾ç…§æ™‚é–“æ’åº (å› ç‚º Firestore é è¨­ä¸ä¿è­‰é †åº)
                scheduleData.sort((a, b) => a.time.localeCompare(b.time));
                
                renderSchedules(); // ç•«å‡ºç•«é¢
            } catch (e) {
                console.error("è®€å–éŒ¯èª¤: ", e);
                alert("è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Console");
            }
        }
    
        // ==========================================
        // 5. æ–°å¢/ä¿®æ”¹è³‡æ–™ (Create / Update)
        // ==========================================
        // æ³¨æ„ï¼šå› ç‚ºæ˜¯ moduleï¼Œè¦æ›è¼‰åˆ° window æ‰èƒ½è¢« HTML onclick å‘¼å«
        window.handleFormSubmit = async function(e) {
            e.preventDefault();
            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            btn.innerText = 'è™•ç†ä¸­...';
    
            const id = document.getElementById('input-id').value;
            
            // æº–å‚™è¦å­˜å…¥çš„è³‡æ–™ç‰©ä»¶
            const newItem = {
                day: CURRENT_DAY,
                time: document.getElementById('input-time').value,
                timeEnd: document.getElementById('input-time-end').value || '',
                type: document.getElementById('input-type').value,
                title: document.getElementById('input-title').value,
                location: document.getElementById('input-sub').value,
                link: document.getElementById('input-link').value || '',
                linkText: document.getElementById('input-link-text').value || '',
                note: ''
            };
    
            try {
                if (id) {
                    // --- ä¿®æ”¹æ¨¡å¼ (Update) ---
                    // æ‰¾åˆ°è©² ID çš„æ–‡ä»¶ä¸¦æ›´æ–°
                    const scheduleRef = doc(db, "schedules", id);
                    await updateDoc(scheduleRef, newItem);
                } else {
                    // --- æ–°å¢æ¨¡å¼ (Create) ---
                    // æ–°å¢åˆ° 'schedules' é›†åˆ
                    await addDoc(collection(db, "schedules"), newItem);
                }
                
                // é‡æ–°è®€å–ä¸¦é—œé–‰è¦–çª—
                await loadSchedules();
                closeModal();
            } catch (e) {
                console.error("å„²å­˜éŒ¯èª¤: ", e);
                alert("å„²å­˜å¤±æ•—");
            } finally {
                btn.disabled = false;
                btn.innerText = id ? 'å„²å­˜è®Šæ›´' : 'ç¢ºèªæ–°å¢';
            }
        }
    
        // ==========================================
        // 6. åˆªé™¤è³‡æ–™ (Delete)
        // ==========================================
        window.deleteItem = async function(id) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿ')) return;
    
            try {
                await deleteDoc(doc(db, "schedules", id));
                await loadSchedules(); // é‡æ–°æ•´ç†ç•«é¢
            } catch (e) {
                console.error("åˆªé™¤éŒ¯èª¤: ", e);
                alert("åˆªé™¤å¤±æ•—");
            }
        }
    
        // ==========================================
        // 7. æ¸²æŸ“ç•«é¢ (Render)
        // ==========================================
        function renderSchedules() {
            const container = document.getElementById('schedule-container');
            container.innerHTML = '';
            
            scheduleData.forEach(item => {
                let html = '';
                
                // Icon é‚è¼¯
                let icon = 'fa-map-marker-alt';
                if(item.type==='train'||item.type==='subway') icon='fa-train'; 
                if(item.type==='flight') icon='fa-plane'; 
                if(item.type==='food') icon='fa-utensils'; 
                if(item.type==='shop') icon='fa-shopping-bag'; 
                if(item.type==='car') icon='fa-car'; 
                if(item.type==='hotel') icon='fa-bed'; 
                if(item.type==='bus') icon='fa-bus';
                if(item.type==='ferry') icon='fa-ship';
    
                // é€£çµæŒ‰éˆ•
                const linkBtn = item.link ? 
                    `<a href="${item.link}" target="_blank" class="mt-2 inline-block bg-slate-100 text-custom-green px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-green-100 transition"><i class="fas fa-external-link-alt mr-1"></i> ${item.linkText || 'æŸ¥çœ‹'}</a>` : '';
    
                // æ“ä½œæŒ‰éˆ• (ç·¨è¼¯/åˆªé™¤æ™‚å‚³å…¥ Firebase çš„ ID å­—ä¸²)
                const actionBtns = (isLight = false) => `
                    <div class="flex space-x-3 z-20 relative">
                        <button onclick="editItem('${item.id}')" class="${isLight ? 'text-white/70 hover:text-white' : 'text-slate-300 hover:text-custom-green'} transition"><i class="fas fa-pen"></i></button>
                        <button onclick="deleteItem('${item.id}')" class="${isLight ? 'text-white/70 hover:text-red-200' : 'text-slate-300 hover:text-red-500'} transition"><i class="fas fa-trash"></i></button>
                    </div>`;
    
                // æ¸²æŸ“é‚è¼¯ (èˆ‡åŸæœ¬ç›¸åŒ)
                if (item.type === 'flight') {
                    let fromCode = 'DEP', fromName = '', toCode = 'ARR', toName = '';
                    if (item.location && item.location.includes('-')) {
                        const parts = item.location.split(/[-â€“â€”>]/);
                        if(parts.length >= 2) {
                            const fromPart = parts[0].trim().split(' '); fromCode = fromPart[0]||'DEP'; fromName = fromPart.slice(1).join(' ')||'';
                            const toPart = parts[1].trim().split(' '); toCode = toPart[0]||'ARR'; toName = toPart.slice(1).join(' ')||'';
                        }
                    } else { fromCode = item.location || ''; }
    
                    html = `
                    <div class="mx-4 p-5 bg-gradient-custom rounded-3xl shadow-lg shadow-green-200 text-white relative transform transition hover:scale-[1.02]">
                        <div class="flex justify-between items-start mb-4"><span class="bg-white/20 px-2 py-0.5 rounded text-xs font-bold uppercase">FLIGHT</span>${actionBtns(true)}</div>
                        <div class="flex justify-between items-center px-1 mb-4">
                            <div class="text-center flex flex-col items-center"><div class="text-2xl font-bold mb-1">${item.time}</div><div class="text-[10px] text-green-100 font-bold mb-0.5">FROM</div><div class="text-3xl font-bold tracking-wider">${fromCode}</div><div class="text-xs mt-0.5">${fromName}</div></div>
                            <div class="flex-1 mx-4 flex flex-col items-center pb-4"><i class="fas fa-plane text-2xl mb-1 transform rotate-45 text-white/90"></i><div class="w-full border-t border-dashed border-white/40"></div></div>
                            <div class="text-center flex flex-col items-center"><div class="text-2xl font-bold mb-1">${item.timeEnd || '--:--'}</div><div class="text-[10px] text-green-100 font-bold mb-0.5">TO</div><div class="text-3xl font-bold tracking-wider">${toCode}</div><div class="text-xs mt-0.5">${toName}</div></div>
                        </div>
                        <div class="flex justify-between items-center border-t border-white/10 pt-3"><div class="text-sm font-medium">${item.title}</div><div class="bg-white/20 px-2 py-1 rounded text-[10px] font-bold">å·²ç¢ºèª</div></div>
                    </div>`;
                } else {
                    let iconBg = 'bg-custom-green';
                    if (item.type === 'food') iconBg = 'bg-orange-400';
                    if (item.type === 'shop') iconBg = 'bg-pink-400';
                    if (item.type === 'hotel') iconBg = 'bg-indigo-400';
                    if (item.type === 'car') iconBg = 'bg-blue-500';
                    
                    html = `
                    <div class="mx-4 bg-white rounded-3xl shadow-sm p-5 flex transform transition hover:scale-[1.02]">
                        <div class="flex flex-col items-center mr-4"><div class="w-12 h-12 ${iconBg} rounded-2xl flex items-center justify-center text-white text-xl mb-2 shadow-md"><i class="fas ${icon}"></i></div><div class="text-sm font-bold text-slate-700">${item.time}</div></div>
                        <div class="flex-1"><div class="flex justify-between items-start"><h3 class="font-bold text-lg text-slate-800">${item.title}</h3>${actionBtns(false)}</div>
                            <div class="flex items-center text-xs text-slate-500 mt-1 mb-1"><span class="text-custom-green font-bold mr-2"><i class="fas fa-map-pin"></i></span><span>${item.location || ''}</span></div>
                            ${item.note ? `<div class="text-xs text-slate-400 mb-1">${item.note}</div>` : ''}${linkBtn}
                        </div>
                    </div>`;
                }
                container.innerHTML += html;
            });
        }
    
        // ==========================================
        // 8. ä»‹é¢æ“ä½œ (Modal, Edit, Toggle)
        // ==========================================
        // é€™è£¡ä¹Ÿè¦æ›è¼‰åˆ° window
        window.openModal = function() { 
            document.getElementById('add-form').reset(); 
            document.getElementById('input-id').value=''; 
            document.getElementById('modal-title').innerText='æ–°å¢è¡Œç¨‹'; 
            document.getElementById('submit-btn').innerText='ç¢ºèªæ–°å¢'; 
            toggleFlightInputs(); 
            document.getElementById('add-modal').classList.remove('hidden'); 
        }
        
        window.closeModal = function() { document.getElementById('add-modal').classList.add('hidden'); }
        
        // ç¶å®šèƒŒæ™¯é»æ“Šé—œé–‰
        document.getElementById('add-modal').addEventListener('click', function(e){if(e.target===this)closeModal()});
    
        // ç·¨è¼¯ (å°‡è³‡æ–™å¡«å›è¡¨å–®)
        window.editItem = function(id) {
            const item = scheduleData.find(x => x.id === id);
            if(item){
                document.getElementById('input-id').value = item.id;
                document.getElementById('input-type').value = item.type;
                
                // è§¸ç™¼ä¸€ä¸‹ toggle ä»¥é¡¯ç¤º/éš±è—èˆªç­æ¬„ä½
                toggleFlightInputs();
    
                document.getElementById('input-time').value = item.time;
                if(item.type === 'flight') {
                    document.getElementById('input-time-end').value = item.timeEnd || '';
                }
                document.getElementById('input-title').value = item.title;
                document.getElementById('input-sub').value = item.location;
                document.getElementById('input-link').value = item.link || '';
                document.getElementById('input-link-text').value = item.linkText || '';
                
                document.getElementById('modal-title').innerText = 'ç·¨è¼¯è¡Œç¨‹';
                document.getElementById('submit-btn').innerText = 'å„²å­˜è®Šæ›´';
                document.getElementById('add-modal').classList.remove('hidden');
            }
        }
    
        // èˆªç­è¼¸å…¥æ¡†åˆ‡æ›
        window.toggleFlightInputs = function() {
            const type = document.getElementById('input-type').value;
            const arrivalBlock = document.getElementById('arrival-time-block');
            const startLabel = document.getElementById('label-time-start');
            const hint = document.getElementById('flight-hint');
            if (type === 'flight') {
                arrivalBlock.classList.remove('hidden');
                startLabel.innerText = 'å‡ºç™¼æ™‚é–“';
                hint.classList.remove('hidden');
            } else {
                arrivalBlock.classList.add('hidden');
                startLabel.innerText = 'æ™‚é–“';
                hint.classList.add('hidden');
            }
        }
    
        // ä¿®æ”¹ 1: æ”¹ç”¨ DOMContentLoadedï¼Œè®“å®ƒä¸€è®€å®Œ HTML å°±åŸ·è¡Œï¼Œä¸ç”¨ç­‰åœ–ç‰‡
        document.addEventListener('DOMContentLoaded', function() {
            const activeTab = document.getElementById('active-tab');
            const container = document.getElementById('date-nav');
            
            if (activeTab && container) {
                // è¨ˆç®—ä½ç½®ï¼šä¿ç•™å·¦é‚Šç´„ 80px çš„ç©ºé–“
                const targetScroll = activeTab.offsetLeft - 80;
                
                // ä¿®æ”¹ 2: å°‡ behavior æ”¹ç‚º 'auto' (ç¬é–“è·³è½‰)ï¼Œé€™æ¨£ä½¿ç”¨è€…å°±ä¸æœƒçœ‹åˆ°æ»‘å‹•çš„éç¨‹
                container.scrollTo({
                    left: targetScroll,
                    behavior: 'auto' 
                });
            }
        });

        // å…¶ä»–è¼‰å…¥å‡½å¼ç¶­æŒåœ¨ load äº‹ä»¶ (é¿å…å½±éŸ¿å®šä½)
        window.addEventListener('load', function() {
            if (typeof loadAllData === 'function') loadAllData();     // Index ç”¨çš„
            if (typeof renderWeatherWidget === 'function') renderWeatherWidget(); // Index ç”¨çš„
            if (typeof loadSchedules === 'function') loadSchedules(); // Day åˆ†é ç”¨çš„
            if (typeof fetchWeather === 'function') fetchWeather();   // Day åˆ†é ç”¨çš„
        });
    
    </script>
</body>
</html>